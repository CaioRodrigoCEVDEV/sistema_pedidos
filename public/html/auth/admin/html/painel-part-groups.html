<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title id="title"></title>
    <link rel="shortcut icon" href="/uploads/logo.jpg" type="image/x-icon" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="/uploads/apple-touch-icon.png"
    />
    <!--Links proprios-->
    <link rel="stylesheet" href="/html/auth/admin/css/style.css" />
    <link rel="stylesheet" href="/html/auth/admin/css/style-flexbox.css" />
    <link rel="stylesheet" href="/html/auth/admin/css/style-components.css" />
    <!--links bootstrap-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />
    <!--Link tema personalizado bootstrap-->
    <link rel="stylesheet" href="../../../../css/tema-bootstrap.css" />
    <!--link tema-->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      integrity="sha384-tViUnnbYAV00FLIhhi3v/dWt3Jxw4gZQcNoSCxCIFNJVCx7/D55/wXsrNIRANwdD"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
  </head>

  <body class="bg-light">
    <div class="wrapper">
      <header id="header-admin">
        <!--Conteudo do header adicionado via JS-->
      </header>
      <main class="p-3">
        <div class="container">
          <div class="panel-hero mb-4">
            <div
              class="d-flex flex-column flex-md-row align-items-start align-items-md-center gap-3"
            >
              <div class="d-flex align-items-center gap-3">
                <div class="icon-circle" aria-hidden="true">
                  <i class="bi bi-diagram-3 text-primary"></i>
                </div>
                <div>
                  <h1 class="h4 mb-0">Grupos de Compatibilidade</h1>
                  <div class="text-muted small">
                    Gerencie grupos de peças compatíveis — Peças no mesmo grupo compartilham o estoque.
                  </div>
                </div>
              </div>
              <div
                class="ms-md-auto d-flex flex-wrap gap-2 align-items-center"
              >
                <button
                  type="button"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#modalCriarGrupo"
                >
                  <i class="bi bi-plus-lg"></i> Novo Grupo
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Groups List -->
        <div class="container">
          <div class="container py-3 bg-white my-3 border rounded shadow">
            <h2 class="h5 mb-3">Lista de Grupos</h2>
            <div style="max-height: 400px; overflow-y: auto">
              <table class="table table-striped table-hover">
                <thead
                  class="thead-dark"
                  style="position: sticky; top: 0; z-index: 10"
                >
                  <tr>
                    <th scope="col">Nome do Grupo</th>
                    <th scope="col" class="text-center">Qtd. Peças</th>
                    <th scope="col" class="text-center">Estoque</th>
                    <th scope="col" class="text-center">Atualizado</th>
                    <th scope="col" class="text-center">Ações</th>
                  </tr>
                </thead>
                <tbody id="tabela-grupos">
                  <tr>
                    <td colspan="5" class="text-center">Carregando...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Group Details Section (hidden by default) -->
        <div class="container" id="detalhesGrupo" style="display: none;">
          <div class="container py-3 bg-white my-3 border rounded shadow">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h2 class="h5 mb-0">
                <span id="nomeGrupoDetalhe">Detalhes do Grupo</span>
              </h2>
              <button type="button" class="btn btn-outline-secondary btn-sm" onclick="fecharDetalhes()">
                <i class="bi bi-x-lg"></i> Fechar
              </button>
            </div>
            
            <!-- Group Info -->
            <div class="row mb-4">
              <div class="col-md-4">
                <div class="card bg-light">
                  <div class="card-body text-center">
                    <h6 class="card-subtitle mb-2 text-muted">Estoque do Grupo</h6>
                    <h3 class="card-title text-primary" id="estoqueGrupoDetalhe">0</h3>
                    <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="abrirModalEditarEstoque()">
                      <i class="bi bi-pencil"></i> Editar
                    </button>
                  </div>
                </div>
              </div>
              <div class="col-md-8">
                <div class="card">
                  <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Peças do Grupo</span>
                    <button type="button" class="btn btn-sm btn-primary" onclick="abrirModalAdicionarPeca()">
                      <i class="bi bi-plus"></i> Adicionar Peça
                    </button>
                  </div>
                  <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                    <table class="table table-sm">
                      <thead>
                        <tr>
                          <th>Código</th>
                          <th>Descrição</th>
                          <th>Preço</th>
                          <th class="text-center">Ação</th>
                        </tr>
                      </thead>
                      <tbody id="tabela-pecas-grupo">
                        <tr>
                          <td colspan="4" class="text-center text-muted">Nenhuma peça no grupo</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <!-- Audit History -->
            <div class="card">
              <div class="card-header">
                <i class="bi bi-clock-history"></i> Histórico de Movimentações
              </div>
              <div class="card-body" style="max-height: 200px; overflow-y: auto;">
                <table class="table table-sm">
                  <thead>
                    <tr>
                      <th>Data</th>
                      <th>Alteração</th>
                      <th>Motivo</th>
                      <th>Peça</th>
                    </tr>
                  </thead>
                  <tbody id="tabela-historico">
                    <tr>
                      <td colspan="4" class="text-center text-muted">Sem histórico</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </main>
      <footer id="footer">
        <!--Conteudo do footer adicionado via JS-->
      </footer>
    </div>

    <!-- Modal Criar Grupo -->
    <div class="modal fade" id="modalCriarGrupo" tabindex="-1" aria-labelledby="modalCriarGrupoLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalCriarGrupoLabel">Criar Novo Grupo</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="formCriarGrupo">
              <div class="mb-3">
                <label for="nomeGrupo" class="form-label">Nome do Grupo</label>
                <input type="text" class="form-control" id="nomeGrupo" required placeholder="Ex: Tela Samsung A50/A50s">
              </div>
              <div class="mb-3">
                <label for="estoqueInicial" class="form-label">Estoque Inicial</label>
                <input type="number" class="form-control" id="estoqueInicial" value="0" min="0">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" onclick="criarGrupo()">Criar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Editar Grupo -->
    <div class="modal fade" id="modalEditarGrupo" tabindex="-1" aria-labelledby="modalEditarGrupoLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalEditarGrupoLabel">Editar Grupo</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="formEditarGrupo">
              <input type="hidden" id="editarGrupoId">
              <div class="mb-3">
                <label for="editarNomeGrupo" class="form-label">Nome do Grupo</label>
                <input type="text" class="form-control" id="editarNomeGrupo" required>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" onclick="salvarEdicaoGrupo()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Editar Estoque -->
    <div class="modal fade" id="modalEditarEstoque" tabindex="-1" aria-labelledby="modalEditarEstoqueLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalEditarEstoqueLabel">Editar Estoque do Grupo</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="formEditarEstoque">
              <div class="mb-3">
                <label for="novoEstoque" class="form-label">Nova Quantidade</label>
                <input type="number" class="form-control" id="novoEstoque" min="0" required>
              </div>
              <div class="mb-3">
                <label for="motivoEstoque" class="form-label">Motivo</label>
                <select class="form-select" id="motivoEstoque">
                  <option value="manual_adjustment">Ajuste Manual</option>
                  <option value="inventory_count">Contagem de Inventário</option>
                  <option value="correction">Correção</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" onclick="salvarEstoque()">Salvar</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Adicionar Peça -->
    <div class="modal fade" id="modalAdicionarPeca" tabindex="-1" aria-labelledby="modalAdicionarPecaLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalAdicionarPecaLabel">Adicionar Peça ao Grupo</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <input type="text" class="form-control" id="pesquisaPeca" placeholder="Pesquisar peça...">
            </div>
            <div style="max-height: 300px; overflow-y: auto;">
              <table class="table table-sm table-hover">
                <thead>
                  <tr>
                    <th>Código</th>
                    <th>Descrição</th>
                    <th>Marca</th>
                    <th>Tipo</th>
                    <th class="text-center">Ação</th>
                  </tr>
                </thead>
                <tbody id="tabela-pecas-disponiveis">
                  <tr>
                    <td colspan="5" class="text-center">Carregando...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <script src="html/auth/js/componentes.js"></script>
    <script src="/config.js"></script>
    <script src="html/auth/js/painel-part-groups.js"></script>
    <script src="../js/nomeEmpresa.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
